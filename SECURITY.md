# Security – Casino RPRM (GitHub + Railway + MongoDB)

This project uses **GitHub** for code and version control, **Railway** for hosting (frontend, backend, MongoDB). Below is what is in place and what you **must** do to keep it secure.

---

## What you already have

| Area | Status |
|------|--------|
| **Auth** | Passwords hashed with bcrypt; JWT + session; `isAuthenticated` / `isAdmin` on routes |
| **Secrets** | Session/JWT use `SESSION_SECRET` from env (no hardcoded secrets in code) |
| **Headers** | X-Content-Type-Options, X-Frame-Options, X-XSS-Protection, HSTS |
| **CORS** | Allowed origins set (e.g. your Railway frontend + localhost) |
| **Cookies** | httpOnly, secure in production, SameSite for cross-origin |
| **Rate limiting** | General API limit (1000/15 min per IP by default) so cashiers/managers aren’t blocked; login limit can be re-enabled later for production |
| **Audit** | Login/logout and sensitive actions logged |

---

## Critical: secrets and .env

### 1. Never commit `.env` to GitHub

- `.env` must contain **real** values: `DATABASE_URL` (MongoDB password), `SESSION_SECRET`, etc.
- If `.env` is ever pushed to GitHub, anyone with repo access can read your DB and forge sessions.
- **Do this:**
  - Use the repo **root** `.gitignore` and **backend** `.gitignore` so `.env` and `.env.local` are ignored.
  - Before pushing, run: `git status` and make sure no `.env` file is staged.

### 2. If `.env` was ever committed in the past

- Assume the contents are **compromised**.
- **Rotate immediately:**
  1. **MongoDB (Railway):** Change the database user password in Railway (MongoDB service → Variables / Connect and regenerate credentials).
  2. **SESSION_SECRET:** Generate a new long random value (e.g. `openssl rand -base64 32`) and set it in Railway (see below).
  3. Remove `.env` from Git history or create a new repo and stop using the old one for this project (and never push secrets again).

### 3. Production (Railway): use environment variables, not `.env` in repo

- On Railway, do **not** rely on a committed `.env` file.
- Set everything in **Railway → your backend service → Variables** (and frontend if needed):
  - `DATABASE_URL` – from Railway MongoDB “Connect” (or internal URL Railway gives you).
  - `SESSION_SECRET` – long random string (e.g. 32+ chars).
  - `NODE_ENV=production`
  - Optional: `JWT_EXPIRES_IN`, `RATE_LIMIT_MAX`, etc.
- Your backend already reads `process.env.*`, so Railway’s env vars are enough.

---

## GitHub

- **Code in GitHub is fine** for version control; the risk is **secrets in the repo**.
- Keep `.env` and any file with real credentials out of the repo (via `.gitignore`).
- Use **private** repos if the code is not meant to be public.
- Avoid committing Railway or MongoDB credentials, API keys, or `SESSION_SECRET`.

---

## Railway

- **Database:** Use Railway’s MongoDB (or another DB) and connect with the URL Railway provides. Store it only in Railway Variables, not in code or in Git.
- **Frontend/backend:** Deploy from GitHub; keep build and run commands correct. Ensure the **backend** has all env vars set in Railway (no `.env` file needed in the deployed app).
- **HTTPS:** Railway provides HTTPS; your app already uses `secure: true` cookies in production, which is correct.

---

## MongoDB (on Railway)

- Use a **strong password** for the MongoDB user (generated by Railway or a password manager).
- In production, use the **internal** Railway URL for backend → DB when possible (less exposure than a public URL).
- Never put the full `DATABASE_URL` (with password) in GitHub or in client-side code.

---

## Optional improvements

1. **Stronger SESSION_SECRET:** e.g. `openssl rand -base64 32` and set in Railway.
2. **Login rate limit** (when moving to production): re-enable a stricter limit on `/api/login` (e.g. 5–10 attempts per 15 min per IP) to reduce brute-force risk.
3. **Shorter JWT expiry** for sensitive roles: e.g. `JWT_EXPIRES_IN=1h` and refresh token flow later if needed.
4. **Helmet:** Add `helmet` middleware on the backend for extra security headers.
5. **Input validation:** Validate and sanitize all API inputs (e.g. with `express-validator` or similar) to reduce injection and bad data risk.
6. **MongoDB:** Ensure network/firewall rules on Railway restrict DB access to only the backend service if possible.

---

## Summary

- **Enough for a basic casino-style app:** Yes, if you **never commit `.env`**, use **Railway env vars in production**, and **rotate MongoDB password and SESSION_SECRET** if `.env` was ever in Git history.
- **GitHub:** Safe for code and version control; unsafe for secrets.
- **Railway:** Use it for hosting and set all secrets in Railway Variables.
- **MongoDB:** Use strong credentials and keep the connection string only in env (Railway), never in the repo.

If you want, the next step can be adding **Helmet** and a simple **input validation** example for one route.
